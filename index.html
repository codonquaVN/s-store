<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S+ STORE ‚Ä¢ H√≥a ƒë∆°n b√°n h√†ng</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{--accent:#0a8a52;--muted:#666;--paper:#fff;--page-width:1100px;}
  body{font-family: 'Roboto', Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; color:#111; transition: filter 2s ease, opacity 2s ease;}
  body.blurred{ filter: blur(6px); opacity:0.3; }
  .wrap{max-width:var(--page-width); margin:0 auto;}
  .grid{display:grid; grid-template-columns:1fr; gap:14px;}
  @media(min-width:980px){ .grid{grid-template-columns: 450px 1fr;} }
  .card{background:var(--paper); border-radius:8px; padding:16px; box-shadow:0 6px 18px rgba(20,30,40,0.06);}
  h1{margin:0; font-size:20px; color:var(--accent); text-align:center;font-weight:700}
  h3{margin:0 0 12px 0; font-size:16px; color:#333; border-bottom:2px solid var(--accent); padding-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  label{display:block; font-weight:600; margin-top:12px; font-size:14px; color:#333}
  input[type=text], input[type=number], input[type=date], select, textarea{width:100%; padding:10px 12px; border:1px solid #d8dbe0; border-radius:6px; box-sizing:border-box; font-size:15px; margin-top:6px;}
  input:focus, select:focus, textarea:focus{outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(10,138,82,0.1);}
  textarea{min-height:70px; resize:vertical;}
  .row{display:flex; gap:10px;}
  .col{flex:1}
  .btn{display:inline-block; padding:12px 18px; border-radius:6px; border:none; cursor:pointer; font-weight:700; font-size:15px; transition:all 0.2s}
  .btn-primary{background:var(--accent); color:#fff}
  .btn-primary:hover{background:#087d48; transform:translateY(-1px); box-shadow:0 4px 12px rgba(10,138,82,0.3)}
  .btn-ghost{background:#fff; border:2px solid #ddd; color:#333}
  .btn-ghost:hover{border-color:var(--accent); color:var(--accent)}
  .btn-danger{background:#c40000; color:#fff}
  .btn-danger:hover{background:#900}
  .btn-sm{padding:8px 12px; font-size:13px}
  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
  .qr-wrap{display:flex; gap:12px; align-items:center}
  .qr-wrap img{width:92px;height:92px;border-radius:6px;border:1px solid #e6e6e6;object-fit:cover}
  .preview{padding:20px; background:#fff; border-radius:6px; border:1px solid #e1e1e1}
  .inv-header{ text-align:center; margin-bottom:18px }
  .inv-header .inv-title{font-weight:900; font-size:18px; color:var(--accent); margin-bottom:8px}
  .inv-sub{font-size:13px; color:#333; margin-bottom:10px; line-height:1.25}
  .inv-meta{display:flex; justify-content:space-between; margin:8px 0; font-size:13px}
  .inv-table{width:100%; border-collapse:collapse; margin-top:8px;}
  .inv-table th, .inv-table td{border:1px solid #000; padding:8px; font-size:13px; vertical-align:top}
  .inv-table th{background:#f3f7f6; font-weight:700}
  .text-right{ text-align:right }
  .red{color:#c40000; font-weight:700}
  .bold{font-weight:700}
  .notes{font-size:13px; margin-top:12px; color:#333; line-height:1.5}
  .product-cards{margin-top:12px;}
  .product-card{background:#f8f9fa;border:2px solid #e1e8ed;border-radius:8px;padding:14px;margin-bottom:12px;position:relative;}
  .product-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
  .product-number{font-weight:700;color:var(--accent);font-size:15px;}
  .product-card input, .product-card select{font-size:14px;padding:9px 11px;}
  .bank-block{margin-top:14px;font-weight:700;color:#6b3a00;display:flex;align-items:center;gap:16px;}
  .bank-info{flex:1;text-align:center;}
  .bank-info div{margin:4px 0;}
  #pvOwnerName{font-weight:900;font-size:16px;color:var(--accent);}
  .center{ text-align:center }
  @media print{
    body{background:#fff}
    .no-print{display:none}
    .wrap{max-width:800px; margin:0}
    .card, .btn{box-shadow:none}
    .inv-table th, .inv-table td{font-size:12px; padding:6px}
    .qr-wrap img{width:80px;height:80px}
  }
  #login-container {position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); opacity: 1; transition: opacity 2s ease; z-index: 1000;}
  #login-box {background: white; padding: 30px 40px; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.1); text-align: center; animation: fadeIn 1.5s ease;}
  @keyframes fadeIn {from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); }}
  #login-box input {display:block; width:250px; margin:10px auto; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:16px;}
  #login-box button {background:#0a8a52; color:white; border:none; padding:10px 20px; border-radius:6px; font-weight:700; cursor:pointer;}
  #login-box button:hover { background:#056837; }
  #logout-btn {position: fixed; top: 10px; right: 15px; background: #c40000; color: #fff; border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight:600; cursor: pointer; display: none; z-index: 2000;}
  #logout-btn:hover { background:#900; }
</style>
</head>
<body>

<div id="login-container">
  <div id="login-box">
    <h2>ƒêƒÉng nh·∫≠p S-STORE</h2>
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" autocomplete="off" />
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" />
    <button id="login-btn">ƒêƒÉng nh·∫≠p</button>
    <p id="login-message" style="color:red; margin-top:10px;"></p>
  </div>
</div>
<button id="logout-btn">ƒêƒÉng xu·∫•t</button>

<div class="wrap">
<h1>S+ Store - H√ìA ƒê∆†N B√ÅN H√ÄNG & D·ªäCH V·ª§</h1>
<p class="small center" style="margin-top:8px; margin-bottom:14px">S·ªê 1 ng√µ 50 L∆Ø∆†NG TH·∫æ VINH - H√Ä N·ªòI</p>
<div class="grid">
  <!-- FORM H√ìA ƒê∆†N -->
  <div class="card no-print">
    <h3>üìã Th√¥ng tin h√≥a ƒë∆°n</h3>
    
    <label>Ch·ªçn ch·ªß t√†i kho·∫£n</label>
    <select id="ownerSelect"></select>
    
    <div style="display:flex; gap:10px; align-items:center; margin-top:12px;">
      <div style="flex:1">
        <label>T√™n ch·ªß TK</label><input id="ownerName" type="text" readonly>
        <label style="margin-top:6px">Ng√¢n h√†ng & STK</label><input id="ownerBank" type="text" readonly>
        <label style="margin-top:6px">Li√™n h·ªá</label><input id="ownerContact" type="text" readonly>
      </div>
      <div style="width:110px; text-align:center;">
        <label style="font-size:12px">QR chuy·ªÉn kho·∫£n</label>
        <div class="qr-wrap"><img id="ownerQR" alt="QR"></div>
      </div>
    </div>
    
    <hr style="margin:16px 0; border:none; border-top:1px solid #e6e6e6">
    
    <label>Ng√†y h√≥a ƒë∆°n</label>
    <input id="invoiceDate" type="date">
    
    <label>T√™n kh√°ch h√†ng</label>
    <input id="tenkhach" type="text" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A">
    
    <div class="row">
      <div class="col">
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input id="sdt" type="text" placeholder="0987654321">
      </div>
      <div class="col">
        <label>ƒê·ªãa ch·ªâ</label>
        <input id="diachi" type="text" placeholder="H√† N·ªôi">
      </div>
    </div>
    
    <hr style="margin:16px 0; border:none; border-top:1px solid #e6e6e6">
    
    <h3 style="margin-bottom:8px">üõí S·∫£n ph·∫©m / D·ªãch v·ª•</h3>
    <div class="product-cards" id="productCards"></div>
    <button type="button" class="btn btn-ghost btn-sm" onclick="addProductCard()" style="width:100%">+ Th√™m s·∫£n ph·∫©m</button>
    
    <label>Ghi ch√∫</label>
    <textarea id="ghichu" placeholder="Ghi ch√∫ th√™m v·ªÅ ƒë∆°n h√†ng..."></textarea>
    <input id="invoiceId" type="hidden">
    
    <div class="actions">
      <button class="btn btn-primary" onclick="handleSave(false)" style="flex:1">üíæ L∆∞u & Xem</button>
      <button class="btn btn-primary" onclick="handleSave(true)" style="flex:1">üñ®Ô∏è L∆∞u & In</button>
      <button class="btn btn-ghost" onclick="resetForm()" style="flex:1">üóëÔ∏è X√≥a form</button>
    </div>
  </div>

  <!-- PREVIEW H√ìA ƒê∆†N -->
  <div class="card preview">
    <div id="previewArea">
      <div class="inv-header">
        <div class="inv-title">S+ Store - ƒêI·ªÜN THO·∫†I ƒêI·ªÜN M√ÅY CH√çNH H√ÉNG</div>
        <div class="inv-sub">S·ªê 1 ng√µ 50 L∆Ø∆†NG TH·∫æ VINH - H√Ä N·ªòI</div>
        <div style="margin-top:6px; font-weight:700; font-size:18px;">H√ìA ƒê∆†N B√ÅN H√ÄNG & D·ªäCH V·ª§</div>
      </div>
      <div id="invoicePreview" style="display:none">
        <div class="inv-meta">
          <div>
            <div><b>Kh√°ch h√†ng:</b> <span id="pvCustomer"></span></div>
            <div><b>ƒê·ªãa ch·ªâ:</b> <span id="pvAddress"></span></div>
            <div><b>Ghi ch√∫:</b> <span id="pvNote"></span></div>
          </div>
          <div style="text-align:right">
            <div><b>NG√ÄY</b></div>
            <div id="pvDate"></div>
            <div style="margin-top:8px"><b>S·ªë h√≥a ƒë∆°n:</b> <span id="pvInvoiceId"></span></div>
          </div>
        </div>
        <table class="inv-table">
          <thead>
            <tr>
              <th style="width:30%">M·∫∂T H√ÄNG/D·ªäCH V·ª§</th>
              <th style="width:18%">NOTE/IMEI</th>
              <th style="width:6%">SL</th>
              <th style="width:14%">GI√Å</th>
              <th style="width:12%">GI·∫¢M</th>
              <th style="width:14%">THANH TO√ÅN</th>
            </tr>
          </thead>
          <tbody id="pvItems"></tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="text-right bold">T·ªîNG</td>
              <td id="pvTotal" class="text-right bold"></td>
            </tr>
            <tr>
              <td colspan="6" class="red bold">B·∫±ng Ch·ªØ : <span id="pvInWords"></span></td>
            </tr>
          </tfoot>
        </table>
        <div class="notes">
          <b style="color:#b35d00">* L∆∞u √ù/B·∫£o H√†nh:</b>
          <ul>
            <li>Bao check ƒë·∫£m b·∫£o ƒë√∫ng t√¨nh tr·∫°ng khi xu·∫•t b√°n</li>
            <li id="warrantyLine">B·∫£o h√†nh theo th·ªùi gian ghi tr√™n h√≥a ƒë∆°n (M√†n h√¨nh BH c·∫£m ·ª©ng, kh√¥ng b·∫£o h√†nh hi·ªÉn th·ªã, ngo·∫°i quan: V·ª° - S·ªçc - Nh√°y - M·ª±c - Ch·∫øt ƒêen...)</li>
            <li id="imeiLine">Thi·∫øt b·ªã b·∫£o h√†nh ƒë√∫ng IMEI, c√≤n tem BH, ch∆∞a can thi·ªáp b√™n th·ª© ba</li>
          </ul>
        </div>
        <div class="bank-block">
          <div class="bank-info">
            <div><b>Ch·ªß TK:</b> <span id="pvOwnerName"></span></div>
            <div id="pvOwnerBank"></div>
            <div id="pvOwnerContact"></div>
          </div>
          <div style="text-align:center;">
            <img id="pvQR" alt="QR" style="width:110px;height:110px;border:1px solid #eee;object-fit:cover">
            <div style="color:#c40000; font-size:11px; margin-top:6px; line-height:1.4; font-weight:500; max-width:110px; margin-left:auto; margin-right:auto;">
              Qu√Ω kh√°ch vui l√≤ng ch·ª•p l·∫°i ·∫£nh chuy·ªÉn kho·∫£n ƒë·ªÉ ti·ªán ƒë·ªëi chi·∫øu
            </div>
          </div>
        </div>
        <p class="center" style="margin-top:16px; font-weight:700;">TR√ÇN TR·ªåNG C·∫¢M ∆†N</p>
      </div>
    </div>
  </div>
</div>
</div>

<!-- JS -->
<script>
// ==== OWNER ====
const OWNERS = [
  { id: 'owner1', name: 'Ng√¥ Minh Ho√†ng', bank: 'Techcombank : 9694999999', contact: '0977.818.000', qrLink: 'https://i.postimg.cc/4yhDx4cW/hoang.jpg' },
  { id: 'owner2', name: 'Nguy·ªÖn VƒÉn Di·ªÖn ', bank: 'Techcombank : 2255992888', contact: '0899.925.890', qrLink: 'https://i.postimg.cc/MT0R2VPR/dien.jpg' },
  { id: 'owner3', name: 'Ph·∫°m Trung Th√†nh', bank: 'Vietcombank : 0491000106412', contact: '098.6368.224', qrLink: 'https://i.postimg.cc/9F0416hy/thanh.png' },
  { id: 'owner4', name: 'ƒê·ªó H·ªìng Ph∆∞∆°ng ', bank: 'MB Bank : 8922228688888', contact: '0982.421.468', qrLink: 'https://i.postimg.cc/Gmh1kRnH/a-ph-ng.jpg' },
  { id: 'owner5', name: 'Qu√°ch Ho√†ng Chinh ', bank: 'Techcombank : 190333180198012', contact: '0979.144.688', qrLink: 'https://i.postimg.cc/pVFVTPRz/a-chinh.jpg' },
  { id: 'owner6', name: 'Nguy·ªÖn V√¢n C∆∞∆°ng ', bank: 'xxxx : 12345678', contact: 'xxxx', qrLink: 'https://i.postimg.cc/MT0R2VPR/dien.jpg' },
];
function el(id){return document.getElementById(id);}
const ownerSelect = el('ownerSelect');
OWNERS.forEach(o => { const opt = document.createElement('option'); opt.value=o.id; opt.text=o.name; ownerSelect.appendChild(opt); });
ownerSelect.addEventListener('change', updateOwnerInfo);
function updateOwnerInfo(){ 
  const sel = OWNERS.find(o=>o.id===ownerSelect.value);
  if(sel){
    el('ownerName').value=sel.name; 
    el('ownerBank').value=sel.bank; 
    el('ownerContact').value=sel.contact; 
    el('ownerQR').src=sel.qrLink;
    el('pvOwnerName').textContent = sel.name;
    el('pvOwnerBank').textContent = sel.bank;
    el('pvOwnerContact').textContent = sel.contact;
    el('pvQR').src = sel.qrLink;
  }
}
ownerSelect.value=OWNERS[0].id; updateOwnerInfo();

// ==== PRODUCT CARD ====
let productCount=0;
function addProductCard(p={name:'',imei:'',qty:1,price:0,discount:0,warranty:''}){
  productCount++;
  const container = el('productCards');
  const card = document.createElement('div'); card.className='product-card'; card.dataset.index=productCount;
  card.innerHTML=`
    <div class="product-card-header">
      <span class="product-number">#${productCount}</span>
      <button type="button" class="btn btn-danger btn-sm" onclick="removeProductCard(this)">X√≥a</button>
    </div>
    <label>T√™n s·∫£n ph·∫©m</label><input type="text" class="p-name" value="${p.name}">
    <label>IMEI / Note</label><input type="text" class="p-imei" value="${p.imei}">
    <div class="row">
      <div class="col"><label>S·ªë l∆∞·ª£ng</label><input type="number" class="p-qty" value="${p.qty}" min="1"></div>
      <div class="col"><label>Gi√°</label><input type="number" class="p-price" value="${p.price}" min="0"></div>
      <div class="col"><label>Gi·∫£m</label><input type="number" class="p-discount" value="${p.discount}" min="0"></div>
      <div class="col"><label>B·∫£o h√†nh</label><input type="text" class="p-warranty" value="${p.warranty}"></div>
    </div>
  `;
  container.appendChild(card);
}
function removeProductCard(btn){ btn.closest('.product-card').remove(); }

// ==== FORM HANDLER ====
function resetForm(){ el('tenkhach').value=''; el('sdt').value=''; el('diachi').value=''; el('ghichu').value=''; el('invoiceId').value=''; el('productCards').innerHTML=''; productCount=0; addProductCard(); }
resetForm();
el('invoiceDate').valueAsDate = new Date();
el('invoiceId').value='HD'+Date.now();

// ==== PREVIEW ====
function updatePreview(){
  el('pvCustomer').textContent=el('tenkhach').value;
  el('pvAddress').textContent=el('diachi').value;
  el('pvNote').textContent=el('ghichu').value;
  el('pvDate').textContent=el('invoiceDate').value;
  el('pvInvoiceId').textContent=el('invoiceId').value;
  const tbody = el('pvItems'); tbody.innerHTML='';
  let total=0;
  document.querySelectorAll('.product-card').forEach(card=>{
    const name = card.querySelector('.p-name').value;
    const imei = card.querySelector('.p-imei').value;
    const qty = Number(card.querySelector('.p-qty').value);
    const price = Number(card.querySelector('.p-price').value);
    const discount = Number(card.querySelector('.p-discount').value);
    const warranty = card.querySelector('.p-warranty').value;
    const pay = (price-discount)*qty;
    total+=pay;
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${name}</td><td>${imei}</td><td class="text-right">${qty}</td><td class="text-right">${price}</td><td class="text-right">${discount}</td><td class="text-right">${pay}</td>`;
    tbody.appendChild(tr);
  });
  el('pvTotal').textContent=total;
  el('pvInWords').textContent = numberToWords(total);
}
document.querySelectorAll('input, textarea').forEach(inp=>inp.addEventListener('input',updatePreview));
setInterval(updatePreview,500);

// ==== NUMBER TO WORDS (VIETNAM) ====
function numberToWords(n){
  const ones=["","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n"];
  if(n===0) return "kh√¥ng";
  let str="", i=0;
  while(n>0){
    const block=n%1000;
    if(block>0) str=readBlock(block,i)+" "+str;
    n=Math.floor(n/1000); i++;
  }
  return str.trim();
  function readBlock(n,i){
    let s="";
    const hundred=Math.floor(n/100); const ten=Math.floor((n%100)/10); const one=n%10;
    if(hundred>0) s+=ones[hundred]+" trƒÉm ";
    if(ten>1) s+=ones[ten]+" m∆∞∆°i "; else if(ten===1) s+="m∆∞·ªùi ";
    if(one>0){ if(ten!==0 && one===1) s+="m·ªët "; else if(ten!==0 && one===5) s+="lƒÉm "; else s+=ones[one]+" "; }
    if(i===1) s+="ngh√¨n"; else if(i===2) s+="tri·ªáu"; else if(i===3) s+="t·ª∑";
    return s;
  }
}

// ==== SAVE + IN + SEND GOOGLE SHEETS ====
function handleSave(printFlag){
  updatePreview();
  const invoice = {
    invoiceId: el('invoiceId').value,
    tenkhach: el('tenkhach').value,
    sdt: el('sdt').value,
    diachi: el('diachi').value,
    ghichu: el('ghichu').value,
    owner: el('ownerName').value,
    products: []
  };
  document.querySelectorAll('.product-card').forEach(card=>{
    invoice.products.push({
      name: card.querySelector('.p-name').value,
      imei: card.querySelector('.p-imei').value,
      qty: Number(card.querySelector('.p-qty').value),
      price: Number(card.querySelector('.p-price').value),
      discount: Number(card.querySelector('.p-discount').value),
      warranty: card.querySelector('.p-warranty').value
    });
  });
  sendToGoogleSheets(invoice);
  if(printFlag) { el('invoicePreview').style.display='block'; window.print(); }
  else el('invoicePreview').style.display='block';
}

// ==== GOOGLE SHEETS ====
function sendToGoogleSheets(invoice){
  const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbwH1F1uZ3KuYjbjRMzTVzHSCS1cZq-6OIHh47CeUnIgUOaSjgIiF1zDerJdyM1GdE54vQ/exec'; // Thay b·∫±ng WebApp URL
  const now = new Date();
  const datetime = now.toLocaleString('vi-VN');
  const data={datetime,...invoice};
  console.log('G·ª≠i d·ªØ li·ªáu:', data);
  fetch(WEBAPP_URL,{method:'POST',body:JSON.stringify(data),headers:{'Content-Type':'application/json'}})
  .then(res=>res.json()).then(res=>console.log('‚úÖ G·ª≠i th√†nh c√¥ng!',res))
  .catch(err=>{console.error('‚ùå L·ªói g·ª≠i d·ªØ li·ªáu:',err); alert('G·ª≠i d·ªØ li·ªáu th·∫•t b·∫°i!');});
}

// ==== LOGIN ====
const loginContainer=el('login-container');
const logoutBtn=el('logout-btn');
el('login-btn').onclick=function(){
  const u=el('username').value.trim(); const p=el('password').value.trim();
  if(u==='admin' && p==='123456'){ loginContainer.style.opacity=0; setTimeout(()=>loginContainer.style.display='none',2000); logoutBtn.style.display='block'; }
  else el('login-message').textContent='Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u';
};
logoutBtn.onclick=function(){ location.reload(); };

</script>

</body>
</html>
