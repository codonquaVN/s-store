<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S+ STORE ‚Ä¢ H√≥a ƒë∆°n b√°n h√†ng</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --accent:#0a8a52;
    --muted:#666;
    --paper:#fff;
    --page-width:1100px;
  }
  body{font-family: 'Roboto', Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; color:#111; transition: filter 2s ease, opacity 2s ease;}
  body.blurred{ filter: blur(6px); opacity:0.3; }
  .wrap{max-width:var(--page-width); margin:0 auto;}
  .grid{display:grid; grid-template-columns:1fr; gap:14px;}
  @media(min-width:980px){ .grid{grid-template-columns: 450px 1fr;} }
  .card{background:var(--paper); border-radius:8px; padding:16px; box-shadow:0 6px 18px rgba(20,30,40,0.06);}
  h1{margin:0; font-size:20px; color:var(--accent); text-align:center;font-weight:700}
  h3{margin:0 0 12px 0; font-size:16px; color:#333; border-bottom:2px solid var(--accent); padding-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  label{display:block; font-weight:600; margin-top:12px; font-size:14px; color:#333}
  input[type=text], input[type=number], input[type=date], select, textarea{
    width:100%; padding:10px 12px; border:1px solid #d8dbe0; border-radius:6px; box-sizing:border-box;
    font-size:15px; margin-top:6px;
  }
  input:focus, select:focus, textarea:focus{
    outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(10,138,82,0.1);
  }
  textarea{min-height:70px; resize:vertical;}
  .row{display:flex; gap:10px;}
  .col{flex:1}
  .btn{display:inline-block; padding:12px 18px; border-radius:6px; border:none; cursor:pointer; font-weight:700; font-size:15px; transition:all 0.2s}
  .btn-primary{background:var(--accent); color:#fff}
  .btn-primary:hover{background:#087d48; transform:translateY(-1px); box-shadow:0 4px 12px rgba(10,138,82,0.3)}
  .btn-ghost{background:#fff; border:2px solid #ddd; color:#333}
  .btn-ghost:hover{border-color:var(--accent); color:var(--accent)}
  .btn-danger{background:#c40000; color:#fff}
  .btn-danger:hover{background:#900}
  .btn-sm{padding:8px 12px; font-size:13px}
  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
  .qr-wrap{display:flex; gap:12px; align-items:center}
  .qr-wrap img{width:92px;height:92px;border-radius:6px;border:1px solid #e6e6e6;object-fit:cover}
  .preview{padding:20px; background:#fff; border-radius:6px; border:1px solid #e1e1e1}
  .inv-header{ text-align:center; margin-bottom:18px }
  .inv-header .inv-title{font-weight:900; font-size:18px; color:var(--accent); margin-bottom:8px}
  .inv-sub{font-size:13px; color:#333; margin-bottom:10px; line-height:1.25}
  .inv-meta{display:flex; justify-content:space-between; margin:8px 0; font-size:13px}
  .inv-table{width:100%; border-collapse:collapse; margin-top:8px;}
  .inv-table th, .inv-table td{border:1px solid #000; padding:8px; font-size:13px; vertical-align:top}
  .inv-table th{background:#f3f7f6; font-weight:700}
  .text-right{ text-align:right }
  .red{color:#c40000; font-weight:700}
  .bold{font-weight:700}
  .notes{font-size:13px; margin-top:12px; color:#333; line-height:1.5}
  
  .product-cards{margin-top:12px;}
  .product-card{
    background:#f8f9fa;
    border:2px solid #e1e8ed;
    border-radius:8px;
    padding:14px;
    margin-bottom:12px;
    position:relative;
  }
  .product-card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
  }
  .product-number{
    font-weight:700;
    color:var(--accent);
    font-size:15px;
  }
  .product-card input, .product-card select{
    font-size:14px;
    padding:9px 11px;
  }
  
  .bank-block{
    margin-top:14px; 
    font-weight:700; 
    color:#6b3a00; 
    display:flex; 
    align-items:center; 
    gap:16px;
  }
  .bank-info{
    flex:1;
    text-align:center;
  }
  .bank-info div{
    margin:4px 0;
  }
  #pvOwnerName{
    font-weight:900;
    font-size:16px;
    color:var(--accent);
  }
  
  .center{ text-align:center }
  
  @media print{
    body{background:#fff}
    .no-print{display:none}
    .wrap{max-width:800px; margin:0}
    .card, .btn{box-shadow:none}
    .inv-table th, .inv-table td{font-size:12px; padding:6px}
    .qr-wrap img{width:80px;height:80px}
  }
  
  #login-container {
    position: fixed;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    opacity: 1;
    transition: opacity 2s ease;
    z-index: 1000;
  }
  #login-box {
    background: white;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    text-align: center;
    animation: fadeIn 1.5s ease;
  }
  @keyframes fadeIn {
    from { opacity:0; transform:translateY(20px); }
    to { opacity:1; transform:translateY(0); }
  }
  #login-box input {
    display:block;
    width:250px;
    margin:10px auto;
    padding:10px;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:16px;
  }
  #login-box button {
    background:#0a8a52;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:6px;
    font-weight:700;
    cursor:pointer;
  }
  #login-box button:hover { background:#056837; }
  #logout-btn {
    position: fixed;
    top: 10px;
    right: 15px;
    background: #c40000;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    font-size: 14px;
    font-weight:600;
    cursor: pointer;
    display: none;
    z-index: 2000;
  }
  #logout-btn:hover { background:#900; }
</style>
</head>
<body>

<div id="login-container">
  <div id="login-box">
    <h2>ƒêƒÉng nh·∫≠p S-STORE</h2>
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" autocomplete="off" />
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" />
    <button id="login-btn">ƒêƒÉng nh·∫≠p</button>
    <p id="login-message" style="color:red; margin-top:10px;"></p>
  </div>
</div>
<button id="logout-btn">ƒêƒÉng xu·∫•t</button>

<div class="wrap">
<h1>S+ Store - H√ìA ƒê∆†N B√ÅN H√ÄNG & D·ªäCH V·ª§</h1>
<p class="small center" style="margin-top:8px; margin-bottom:14px">S·ªê 1 ng√µ 50 L∆Ø∆†NG TH·∫æ VINH - H√Ä N·ªòI</p>
<div class="grid">
  <div class="card no-print">
    <h3>üìã Th√¥ng tin h√≥a ƒë∆°n</h3>
    
    <label>Ch·ªçn ch·ªß t√†i kho·∫£n</label>
    <select id="ownerSelect"></select>
    
    <div style="display:flex; gap:10px; align-items:center; margin-top:12px;">
      <div style="flex:1">
        <label>T√™n ch·ªß TK</label><input id="ownerName" type="text" readonly>
        <label style="margin-top:6px">Ng√¢n h√†ng & STK</label><input id="ownerBank" type="text" readonly>
        <label style="margin-top:6px">Li√™n h·ªá</label><input id="ownerContact" type="text" readonly>
      </div>
      <div style="width:110px; text-align:center;">
        <label style="font-size:12px">QR chuy·ªÉn kho·∫£n</label>
        <div class="qr-wrap"><img id="ownerQR" alt="QR"></div>
      </div>
    </div>
    
    <hr style="margin:16px 0; border:none; border-top:1px solid #e6e6e6">
    
    <label>Ng√†y h√≥a ƒë∆°n</label>
    <input id="invoiceDate" type="date">
    
    <label>T√™n kh√°ch h√†ng</label>
    <input id="tenkhach" type="text" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A">
    
    <div class="row">
      <div class="col">
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input id="sdt" type="text" placeholder="0987654321">
      </div>
      <div class="col">
        <label>ƒê·ªãa ch·ªâ</label>
        <input id="diachi" type="text" placeholder="H√† N·ªôi">
      </div>
    </div>
    
    <hr style="margin:16px 0; border:none; border-top:1px solid #e6e6e6">
    
    <h3 style="margin-bottom:8px">üõí S·∫£n ph·∫©m / D·ªãch v·ª•</h3>
    
    <div class="product-cards" id="productCards"></div>
    
    <button type="button" class="btn btn-ghost btn-sm" onclick="addProductCard()" style="width:100%">+ Th√™m s·∫£n ph·∫©m</button>
    
    <label>Ghi ch√∫</label>
    <textarea id="ghichu" placeholder="Ghi ch√∫ th√™m v·ªÅ ƒë∆°n h√†ng..."></textarea>
    
    <input id="invoiceId" type="hidden">
    
    <div class="actions">
      <button class="btn btn-primary" onclick="handleSave(false)" style="flex:1">üíæ L∆∞u & Xem</button>
      <button class="btn btn-primary" onclick="handleSave(true)" style="flex:1">üñ®Ô∏è L∆∞u & In</button>
      <button class="btn btn-ghost" onclick="resetForm()" style="flex:1">üóëÔ∏è X√≥a form</button>
    </div>
  </div>

  <div class="card preview">
    <div id="previewArea">
      <div class="inv-header">
        <div class="inv-title">S+ Store - ƒêI·ªÜN THO·∫†I ƒêI·ªÜN M√ÅY CH√çNH H√ÉNG</div>
        <div class="inv-sub">S·ªê 1 ng√µ 50 L∆Ø∆†NG TH·∫æ VINH - H√Ä N·ªòI</div>
        <div style="margin-top:6px; font-weight:700; font-size:18px;">H√ìA ƒê∆†N B√ÅN H√ÄNG & D·ªäCH V·ª§</div>
      </div>
      <div id="invoicePreview" style="display:none">
        <div class="inv-meta">
          <div>
            <div><b>Kh√°ch h√†ng:</b> <span id="pvCustomer"></span></div>
            <div><b>ƒê·ªãa ch·ªâ:</b> <span id="pvAddress"></span></div>
            <div><b>Ghi ch√∫:</b> <span id="pvNote"></span></div>
          </div>
          <div style="text-align:right">
            <div><b>NG√ÄY</b></div>
            <div id="pvDate"></div>
            <div style="margin-top:8px"><b>S·ªë h√≥a ƒë∆°n:</b> <span id="pvInvoiceId"></span></div>
          </div>
        </div>
        <table class="inv-table">
          <thead>
            <tr>
              <th style="width:30%">M·∫∂T H√ÄNG/D·ªäCH V·ª§</th>
              <th style="width:18%">NOTE/IMEI</th>
              <th style="width:6%">SL</th>
              <th style="width:14%">GI√Å</th>
              <th style="width:12%">GI·∫¢M</th>
              <th style="width:14%">THANH TO√ÅN</th>
            </tr>
          </thead>
          <tbody id="pvItems"></tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="text-right bold">T·ªîNG</td>
              <td id="pvTotal" class="text-right bold"></td>
            </tr>
            <tr>
              <td colspan="6" class="red bold">B·∫±ng Ch·ªØ : <span id="pvInWords"></span></td>
            </tr>
          </tfoot>
        </table>
        <div class="notes">
          <b style="color:#b35d00">* L∆∞u √ù/B·∫£o H√†nh:</b>
          <ul>
            <li>Bao check ƒë·∫£m b·∫£o ƒë√∫ng t√¨nh tr·∫°ng khi xu·∫•t b√°n</li>
            <li id="warrantyLine">B·∫£o h√†nh theo th·ªùi gian ghi tr√™n h√≥a ƒë∆°n (M√†n h√¨nh BH c·∫£m ·ª©ng, kh√¥ng b·∫£o h√†nh hi·ªÉn th·ªã, ngo·∫°i quan: V·ª° - S·ªçc - Nh√°y - M·ª±c - Ch·∫øt ƒêen...)</li>
            <li id="imeiLine">Thi·∫øt b·ªã b·∫£o h√†nh ƒë√∫ng IMEI, c√≤n tem BH, ch∆∞a can thi·ªáp b√™n th·ª© ba</li>
         
          </ul>
        </div>
        
        <div class="bank-block">
          <div class="bank-info">
            <div><b>Ch·ªß TK:</b> <span id="pvOwnerName"></span></div>
            <div id="pvOwnerBank"></div>
            <div id="pvOwnerContact"></div>
          </div>
          <div style="text-align:center;">
            <img id="pvQR" alt="QR" style="width:110px;height:110px;border:1px solid #eee;object-fit:cover">
            <div style="color:#c40000; font-size:11px; margin-top:6px; line-height:1.4; font-weight:500; max-width:110px; margin-left:auto; margin-right:auto;">
              Qu√Ω kh√°ch vui l√≤ng ch·ª•p l·∫°i ·∫£nh chuy·ªÉn kho·∫£n ƒë·ªÉ ti·ªán ƒë·ªëi chi·∫øu
            </div>
          </div>
        </div>
        
        <p class="center" style="margin-top:16px; font-weight:700;">TR√ÇN TR·ªåNG C·∫¢M ∆†N</p>
      </div>
    </div>
  </div>
</div>
</div>

<script>
const OWNERS = [
  { id: 'owner1', name: 'Ng√¥ Minh Ho√†ng', bank: 'Techcombank : 9694999999', contact: '0977.818.000', qrLink: 'https://i.postimg.cc/4yhDx4cW/hoang.jpg' },
  { id: 'owner2', name: 'Nguy·ªÖn VƒÉn Di·ªÖn ', bank: 'Techcombank : 2255992888', contact: '0858.925.890', qrLink: 'https://i.postimg.cc/MT0R2VPR/dien.jpg' },
  { id: 'owner3', name: 'Ph·∫°m Trung Th√†nh', bank: 'Vietcombank : 0491000106412', contact: '098.6368.224', qrLink: 'https://i.postimg.cc/9F0416hy/thanh.png' },
  { id: 'owner4', name: 'ƒê·ªó H·ªìng Ph∆∞∆°ng ', bank: 'MB Bank : 8922228688888', contact: '0982.421.468', qrLink: 'https://i.postimg.cc/Gmh1kRnH/a-ph-ng.jpg' },
  { id: 'owner5', name: 'Qu√°ch Ho√†ng Chinh ', bank: 'Techcombank : 190333180198012', contact: '0979.144.688', qrLink: 'https://i.postimg.cc/pVFVTPRz/a-chinh.jpg' },
  { id: 'owner6', name: 'Nguy·ªÖn V√¢n C∆∞∆°ng ', bank: 'xxxx : 12345678', contact: 'xxxx', qrLink: 'https://i.postimg.cc/MT0R2VPR/dien.jpg' },
];

function el(id){return document.getElementById(id)}
const ownerSelect = el('ownerSelect');
OWNERS.forEach(o => { const opt = document.createElement('option'); opt.value=o.id; opt.textContent=o.name; ownerSelect.appendChild(opt); });

function setOwnerById(id){
  const o = OWNERS.find(x=>x.id===id) || OWNERS[0];
  el('ownerName').value = o.name;
  el('ownerBank').value = o.bank;
  el('ownerContact').value = o.contact;
  el('pvOwnerName').textContent = o.name;
  el('pvOwnerBank').textContent = o.bank;
  el('pvOwnerContact').textContent = 'Li√™n h·ªá: ' + o.contact;
  if(o.qrLink && o.qrLink.trim() !== ''){ el('ownerQR').src=o.qrLink; el('pvQR').src=o.qrLink; } else { el('ownerQR').src=''; el('pvQR').src=''; }
}
ownerSelect.addEventListener('change', e=> setOwnerById(e.target.value));
setOwnerById(ownerSelect.value);

let productCardCount = 0;

function createProductCard(){
  productCardCount++;
  const cardId = `product-${productCardCount}`;
  const card = document.createElement('div');
  card.className = 'product-card';
  card.id = cardId;
  card.innerHTML = `
    <div class="product-card-header">
      <span class="product-number">S·∫£n ph·∫©m #${productCardCount}</span>
      <button type="button" class="btn btn-danger btn-sm" onclick="removeProductCard('${cardId}')">√ó X√≥a</button>
    </div>
    <label>T√™n s·∫£n ph·∫©m / D·ªãch v·ª•</label>
    <input type="text" class="product-name" placeholder="V√≠ d·ª•: iPhone 17 Promax 2TB Cam">
    <label>IMEI / Ghi ch√∫</label>
    <input type="text" class="product-imei" placeholder="S·ªë IMEI ho·∫∑c ghi ch√∫">
    <div class="row">
      <div class="col">
        <label>S·ªë l∆∞·ª£ng</label>
        <input type="number" class="product-qty" value="1" min="1">
      </div>
      <div class="col">
        <label>Gi√° (VNƒê)</label>
        <input type="number" class="product-price" value="0" min="0">
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Gi·∫£m gi√° (VNƒê)</label>
        <input type="number" class="product-discount" value="0" min="0">
      </div>
      <div class="col">
        <label>B·∫£o h√†nh (th√°ng)</label>
        <select class="product-warranty">
          <option value="3">3 th√°ng</option>
          <option value="6">6 th√°ng</option>
          <option value="9">9 th√°ng</option>
          <option value="12">12 th√°ng</option>
        </select>
      </div>
    </div>
  `;
  return card;
}

function addProductCard(){
  const container = el('productCards');
  const card = createProductCard();
  container.appendChild(card);
  updateRemoveButtons();
}

function removeProductCard(cardId){
  const card = document.getElementById(cardId);
  if(card){
    card.remove();
    updateRemoveButtons();
  }
}

function updateRemoveButtons(){
  const cards = document.querySelectorAll('.product-card');
  cards.forEach((card, idx) => {
    const btn = card.querySelector('.btn-danger');
    if(btn){
      btn.disabled = cards.length === 1;
      btn.style.opacity = cards.length === 1 ? '0.5' : '1';
      btn.style.cursor = cards.length === 1 ? 'not-allowed' : 'pointer';
    }
  });
}

function getProducts(){
  const cards = document.querySelectorAll('.product-card');
  const products = [];
  cards.forEach(card => {
    const name = card.querySelector('.product-name').value.trim();
    const imei = card.querySelector('.product-imei').value.trim();
    const qty = parseInt(card.querySelector('.product-qty').value) || 1;
    const price = parseInt(card.querySelector('.product-price').value) || 0;
    const discount = parseInt(card.querySelector('.product-discount').value) || 0;
    const warranty = card.querySelector('.product-warranty').value;
    if(name){
      products.push({ name, imei, qty, price, discount, warranty });
    }
  });
  return products;
}

window.addEventListener('DOMContentLoaded', function() {
  addProductCard();
  const today = new Date().toISOString().split('T')[0];
  el('invoiceDate').value = today;
  el('invoiceId').value = generateInvoiceId(today);
});

function generateInvoiceId(dateValue) {
  const d = dateValue ? new Date(dateValue) : new Date();
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  const dateStr = `${year}${month}${day}`;
  const sameDate = savedInvoices.filter(inv => inv.invoiceId && inv.invoiceId.includes(dateStr));
  const sequence = String(sameDate.length + 1).padStart(3, '0');
  return `INV-${dateStr}-${sequence}`;
}

el('invoiceDate').addEventListener('change', function() {
  el('invoiceId').value = generateInvoiceId(this.value);
});

let savedInvoices = JSON.parse(localStorage.getItem('invoices')||'[]');

function handleSave(print=false){
  const tenkhach = el('tenkhach').value.trim();
  const diachi = el('diachi').value.trim();
  const sdt = el('sdt').value.trim();
  const ghichu = el('ghichu').value.trim();
  const invoiceDate = el('invoiceDate').value;
  const invoiceId = el('invoiceId').value.trim();
  const products = getProducts();
  
  // L·∫§Y T√äN CH·ª¶ T√ÄI KHO·∫¢N
  const ownerName = el('ownerName').value.trim();
  
  const dateObj = new Date(invoiceDate);
  const displayDate = `${String(dateObj.getDate()).padStart(2, '0')}/${String(dateObj.getMonth() + 1).padStart(2, '0')}/${dateObj.getFullYear()}`;
  
  const newInvoice = { 
    invoiceId, 
    tenkhach, 
    diachi, 
    sdt, 
    ghichu, 
    products,
    date: displayDate,
    dateRaw: invoiceDate,
    owner: ownerName  // L∆ØU CH·ª¶ T√ÄI KHO·∫¢N
  };
  
  savedInvoices.push(newInvoice); 
  localStorage.setItem('invoices', JSON.stringify(savedInvoices)); 
  renderPreview(newInvoice);
  sendToGoogleSheets(newInvoice);
  el('invoiceId').value = generateInvoiceId(invoiceDate);
  
  if(print){
    setTimeout(() => window.print(), 500);
  } else {
    alert('‚úÖ ƒê√£ l∆∞u h√≥a ƒë∆°n th√†nh c√¥ng!');
  }
}

function formatMoney(n){
  return new Intl.NumberFormat('vi-VN').format(n);
}

function renderPreview(inv){
  el('pvInvoiceId').textContent = inv.invoiceId;
  el('pvCustomer').textContent = inv.tenkhach + (inv.sdt ? ' | ' + inv.sdt : '');
  el('pvAddress').textContent = inv.diachi || '';
  el('pvNote').textContent = inv.ghichu || '';
  el('pvDate').textContent = inv.date;
  
  const tbody = el('pvItems'); 
  tbody.innerHTML='';
  let totalAmount = 0;
  
  if(inv.products && inv.products.length > 0){
    inv.products.forEach(product => {
      const itemTotal = (product.price - product.discount) * product.qty;
      totalAmount += itemTotal;
      const tr = document.createElement('tr');
      tr.innerHTML=`
        <td>${product.name}</td>
        <td>${product.imei || ''}</td>
        <td class="text-right">${product.qty}</td>
        <td class="text-right">${formatMoney(product.price)}</td>
        <td class="text-right">${formatMoney(product.discount)}</td>
        <td class="text-right">${formatMoney(itemTotal)}</td>
      `;
      tbody.appendChild(tr);
    });
  }
  
  el('pvTotal').textContent = formatMoney(totalAmount);
  el('pvInWords').textContent = numberToWords(totalAmount) + ' ƒë·ªìng';
  
  const firstWarranty = inv.products ? inv.products[0].warranty : inv.baohanh;
  if(firstWarranty){
    el('warrantyLine').textContent = `B·∫£o h√†nh ${firstWarranty} th√°ng (M√†n h√¨nh BH c·∫£m ·ª©ng, kh√¥ng b·∫£o h√†nh hi·ªÉn th·ªã, ngo·∫°i quan: V·ª° - S·ªçc - Nh√°y - M·ª±c - Ch·∫øt ƒêen...)`;
  }
  
  el('invoicePreview').style.display='block';
}

function resetForm(){ 
  if(!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô form?')){
    return;
  }
  el('tenkhach').value = '';
  el('diachi').value = '';
  el('sdt').value = '';
  el('ghichu').value = '';
  const container = el('productCards');
  container.innerHTML = '';
  productCardCount = 0;
  addProductCard();
  const today = new Date().toISOString().split('T')[0];
  el('invoiceDate').value = today;
  el('invoiceId').value = generateInvoiceId(today);
}

function numberToWords(n){
  if(n === 0) return 'Kh√¥ng';
  if(n < 0) return '√Çm ' + numberToWords(-n);
  const units = ['', 'ngh√¨n', 'tri·ªáu', 't·ª∑', 'ngh√¨n t·ª∑', 'tri·ªáu t·ª∑'];
  let result = '';
  let unitIndex = 0;
  while(n > 0){
    let group = n % 1000;
    if(group > 0){
      let groupWords = read3Digits(group, unitIndex > 0 && n > 1000);
      result = groupWords + (units[unitIndex] ? ' ' + units[unitIndex] : '') + (result ? ' ' + result : '');
    }
    n = Math.floor(n / 1000);
    unitIndex++;
  }
  return result.charAt(0).toUpperCase() + result.slice(1);
}

function read3Digits(n, hasHigherGroup){
  if(n === 0) return '';
  const ones = ['', 'm·ªôt', 'hai', 'ba', 'b·ªën', 'nƒÉm', 's√°u', 'b·∫£y', 't√°m', 'ch√≠n'];
  let result = '';
  let hundreds = Math.floor(n / 100);
  let tens = Math.floor((n % 100) / 10);
  let unit = n % 10;
  if(hundreds > 0){
    result += ones[hundreds] + ' trƒÉm';
  } else if(hasHigherGroup) {
    result += 'kh√¥ng trƒÉm';
  }
  if(tens > 1){
    result += (result ? ' ' : '') + ones[tens] + ' m∆∞∆°i';
    if(unit === 1){
      result += ' m·ªët';
    } else if(unit === 5){
      result += ' lƒÉm';
    } else if(unit > 0){
      result += ' ' + ones[unit];
    }
  } else if(tens === 1){
    result += (result ? ' ' : '') + 'm∆∞·ªùi';
    if(unit > 0){
      result += ' ' + ones[unit];
    }
  } else {
    if(unit > 0){
      if(hundreds > 0 || hasHigherGroup){
        result += ' l·∫ª ' + ones[unit];
      } else {
        result += (result ? ' ' : '') + ones[unit];
      }
    }
  }
  return result.trim();
}

function sendToGoogleSheets(invoice) {
  const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbw6T9pnO4ZF4Y1iHm77vFt9tDb0FdYwvbqpiutxw0M/exec';

  
  console.log('üîµ B·∫Øt ƒë·∫ßu g·ª≠i d·ªØ li·ªáu...');
  
  let totalAmount = 0;
  let productsText = '';
  let imeiText = '';
  let quantityText = '';
  let priceText = '';
  let discountText = '';
  let warrantyText = '';
  
  if(invoice.products && invoice.products.length > 0){
    invoice.products.forEach((p, idx) => {
      totalAmount += (p.price - p.discount) * p.qty;
      productsText += (idx > 0 ? ', ' : '') + p.name;
      imeiText += (idx > 0 ? ', ' : '') + (p.imei || '');
      quantityText += (idx > 0 ? ', ' : '') + p.qty;
      priceText += (idx > 0 ? ', ' : '') + formatMoney(p.price);
      discountText += (idx > 0 ? ', ' : '') + formatMoney(p.discount);
      warrantyText += (idx > 0 ? ', ' : '') + p.warranty + ' th√°ng';
    });
  }
  
  const data = {
    datetime: new Date().toLocaleString('vi-VN'),
    invoiceId: invoice.invoiceId,
    customerName: invoice.tenkhach,
    phone: invoice.sdt,
    address: invoice.diachi,
    products: productsText,
    imei: imeiText,
    quantity: quantityText,
    price: priceText,
    discount: discountText,
    warranty: warrantyText,
    total: totalAmount,
    note: invoice.ghichu,
    owner: invoice.owner || 'Kh√¥ng x√°c ƒë·ªãnh'
  };
  
  console.log('üì¶ D·ªØ li·ªáu:', data);
  console.log('üë§ Ch·ªß TK:', data.owner);
  
  // D√πng XMLHttpRequest (t∆∞∆°ng th√≠ch t·ªët v·ªõi c·∫£ PC v√† Mobile)
  const xhr = new XMLHttpRequest();
  xhr.open('POST', WEBAPP_URL, true);
  xhr.setRequestHeader('Content-Type', 'application/json');
  
  xhr.onload = function() {
    console.log('‚úÖ ƒê√£ g·ª≠i th√†nh c√¥ng!');
  };
  
  xhr.onerror = function() {
    console.error('‚ùå L·ªói k·∫øt n·ªëi!');
  };
  
  xhr.ontimeout = function() {
    console.error('‚è±Ô∏è Timeout - m·∫°ng qu√° ch·∫≠m!');
  };
  
  xhr.timeout = 30000; // 30 gi√¢y
  
  try {
    xhr.send(JSON.stringify(data));
  } catch(e) {
    console.error('‚ùå Exception:', e);
  }
}



const USERS = [ { username:'admin', password:'qwerty' } ];
const loginContainer = el('login-container');
const logoutBtn = el('logout-btn');
if(localStorage.getItem('loggedIn')==='true'){
  loginContainer.style.display='none';
  logoutBtn.style.display='block';
  document.body.classList.remove('blurred');
}else{
  document.body.classList.add('blurred');
}
el('login-btn').addEventListener('click',()=>{
  const username = el('username').value.trim();
  const password = el('password').value.trim();
  const message = el('login-message');
  const found = USERS.find(u=>u.username===username && u.password===password);
  if(found){
    message.textContent='';
    document.body.classList.remove('blurred');
    loginContainer.style.opacity='0';
    setTimeout(()=>{
      loginContainer.style.display='none';
      logoutBtn.style.display='block';
      localStorage.setItem('loggedIn','true');
    },2000);
  }else{ message.textContent='Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!'; }
});
logoutBtn.addEventListener('click',()=>{
  if(confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')){
    localStorage.removeItem('loggedIn');
    logoutBtn.style.display='none';
    loginContainer.style.display='flex';
    setTimeout(()=>{ loginContainer.style.opacity='1'; document.body.classList.add('blurred'); },200);
  }
});
</script>

<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', function(e) {
  if(e.keyCode == 123) {
    e.preventDefault();
    return false;
  }
  if(e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) {
    e.preventDefault();
    return false;
  }
  if(e.ctrlKey && e.keyCode == 85) {
    e.preventDefault();
    return false;
  }
  if(e.ctrlKey && e.keyCode == 83) {
    e.preventDefault();
    return false;
  }
});
</script>
  </script>

<!-- ============= B·∫¢O V·ªÜ CODE (phi√™n b·∫£n an to√†n cho Safari/iPhone) ============= -->
<script>
// üîí Ch·∫∑n chu·ªôt ph·∫£i (Right Click)
document.addEventListener('contextmenu', function (e) {
  e.preventDefault();
  alert('‚ö†Ô∏è Ch·ª©c nƒÉng n√†y ƒë√£ b·ªã v√¥ hi·ªáu h√≥a!');
  return false;
});

// üîí Ch·∫∑n c√°c ph√≠m t·∫Øt m·ªü DevTools v√† xem m√£ ngu·ªìn
document.addEventListener('keydown', function (e) {
  // F12
  if (e.keyCode === 123) {
    e.preventDefault();
    alert('‚ö†Ô∏è Ph√≠m F12 ƒë√£ b·ªã v√¥ hi·ªáu h√≥a!');
    return false;
  }

  // Ctrl+Shift+I (Inspect)
  if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
    e.preventDefault();
    alert('‚ö†Ô∏è Ph√≠m t·∫Øt n√†y ƒë√£ b·ªã v√¥ hi·ªáu h√≥a!');
    return false;
  }

  // Ctrl+Shift+J (Console)
  if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
    e.preventDefault();
    alert('‚ö†Ô∏è Ph√≠m t·∫Øt n√†y ƒë√£ b·ªã v√¥ hi·ªáu h√≥a!');
    return false;
  }

  // Ctrl+Shift+C (Inspect Element)
  if (e.ctrlKey && e.shiftKey && e.keyCode === 67) {
    e.preventDefault();
    alert('‚ö†Ô∏è Ph√≠m t·∫Øt n√†y ƒë√£ b·ªã v√¥ hi·ªáu h√≥a!');
    return false;
  }

  // Ctrl+U (View Source)
  if (e.ctrlKey && e.keyCode === 85) {
    e.preventDefault();
    alert('‚ö†Ô∏è Kh√¥ng th·ªÉ xem m√£ ngu·ªìn!');
    return false;
  }

  // Ctrl+S (Save)
  if (e.ctrlKey && e.keyCode === 83) {
    e.preventDefault();
    alert('‚ö†Ô∏è Kh√¥ng th·ªÉ l∆∞u trang!');
    return false;
  }
});

// üîí Ch·∫∑n k√©o, ch·ªçn v√† copy
document.addEventListener('dragstart', e => e.preventDefault());
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('copy', e => {
  e.preventDefault();
  alert('‚ö†Ô∏è Kh√¥ng th·ªÉ sao ch√©p n·ªôi dung!');
  return false;
});

// ‚úÖ Ki·ªÉm tra lo·∫°i tr√¨nh duy·ªát ‚Äì B·ªé QUA v·ªõi Safari / Facebook / Messenger / Instagram
const isSafeBrowser = /FBAN|FBAV|Instagram|Line|Messenger|Safari/i.test(navigator.userAgent);

if (!isSafeBrowser) {
  // üîç Ki·ªÉm tra DevTools theo k√≠ch th∆∞·ªõc c·ª≠a s·ªï (ch·ªâ √°p d·ª•ng tr√™n desktop)
  const devToolsChecker = setInterval(function () {
    const widthThreshold = window.outerWidth - window.innerWidth > 160;
    const heightThreshold = window.outerHeight - window.innerHeight > 160;

    if (widthThreshold || heightThreshold) {
      document.body.innerHTML =
        '<h1 style="text-align:center;margin-top:50px;color:red;">‚ö†Ô∏è VUI L√íNG ƒê√ìNG DEVELOPER TOOLS!</h1>';
      clearInterval(devToolsChecker);
    }
  }, 1000);
} else {
  console.log('üü¢ Safari ho·∫∑c WebView (Facebook/Messenger) ‚Äì b·ªè qua ki·ªÉm tra DevTools.');
}

// üîí Ch·∫∑n c√°c log ra console
console.log = function () {};
console.clear = function () {};
console.dir = function () {};
</script>
<!-- ============= H·∫æT B·∫¢O V·ªÜ ============= -->


</body>
</html>
