<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S-STORE • Hóa đơn bán hàng</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
body{font-family: 'Roboto', Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; color:#111;}
.wrap{max-width:900px; margin:0 auto;}
.card{background:#fff; border-radius:8px; padding:14px; box-shadow:0 6px 18px rgba(20,30,40,0.06);}
h1{margin:0; font-size:20px; color:#0a8a52; text-align:center;font-weight:700;}
label{display:block; margin-top:10px; font-weight:500;}
input, select, textarea{width:100%; padding:8px; margin-top:6px; border:1px solid #d8dbe0; border-radius:6px; box-sizing:border-box;}
textarea{min-height:56px;}
.btn{padding:10px 14px; border-radius:6px; border:none; cursor:pointer; font-weight:700;}
.btn-primary{background:#0a8a52;color:#fff;}
.btn-ghost{background:#fff;border:1px solid #ddd;}
.actions{display:flex; gap:8px; margin-top:12px;}
.preview{margin-top:20px; padding:14px; border:1px solid #ddd; border-radius:6px;}
</style>
</head>
<body>
<div class="wrap">
<h1>S-STORE - HÓA ĐƠN BÁN HÀNG</h1>
<div class="card">
<label>Tên khách hàng</label><input id="tenkhach" type="text" placeholder="Ví dụ: Tú An - 0865...">
<label>Số điện thoại</label><input id="sdt" type="text" placeholder="0865...">
<label>Địa chỉ</label><input id="diachi" type="text" placeholder="Hà Nội">
<label>Mặt hàng / Dịch vụ</label><input id="mathang" type="text">
<label>IMEI / Note</label><input id="imei" type="text">
<label>Số lượng</label><input id="soluong" type="number" value="1">
<label>Giá (VNĐ)</label><input id="gia" type="number" value="0">
<label>Giảm (VNĐ)</label><input id="giam" type="number" value="0">
<label>Bảo hành (tháng)</label>
<select id="baohanh">
<option value="3">3</option>
<option value="6">6</option>
<option value="9">9</option>
<option value="12">12</option>
</select>
<label>Ghi chú</label><textarea id="ghichu"></textarea>
<div class="actions">
<button class="btn btn-primary" onclick="saveInvoice()">Lưu vào Sheet</button>
<button class="btn btn-ghost" onclick="resetForm()">Xóa form</button>
</div>
</div>

<div class="preview card" id="preview">
<h3>Preview Hóa Đơn</h3>
<div id="previewContent"></div>
</div>
</div>

<script>
const WEBAPP_URL = "YOUR_WEBAPP_EXEC_URL_HERE"; // Thay bằng link deploy của bạn

function numberToWordsVN(num){
  num = Number(num)||0;
  if(num===0) return 'Không đồng';
  const units=['','nghìn','triệu','tỷ','nghìn tỷ'];
  const a=['không','một','hai','ba','bốn','năm','sáu','bảy','tám','chín'];
  const read3=x=>{
    const c=Math.floor(x/100),t=Math.floor((x%100)/10),d=x%10;
    let s='';
    if(c>0)s+=a[c]+' trăm ';
    if(t>1)s+=a[t]+' mươi '+(d==1?'mốt':(d==5?'lăm':(d>0?a[d]:'')));
    else if(t==1)s+='mười '+(d>0?(d==5?'lăm':a[d]):'');
    else if(t==0&&d>0)s+=a[d];
    return s.trim();
  };
  let s='',i=0;
  while(num>0){const part=num%1000;if(part>0)s=read3(part)+(units[i]?' '+units[i]+' ':' ')+s;num=Math.floor(num/1000);i++;}
  return s.replace(/\s+/g,' ').trim().replace(/(^\w)/,m=>m.toUpperCase())+' đồng';
}

function genInvoiceId(){
  const d=new Date();
  const yyyy=d.getFullYear();
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const dd=String(d.getDate()).padStart(2,'0');
  const t=String(Date.now()).slice(-4);
  return `INV-${yyyy}${mm}${dd}-${t}`;
}

function previewInvoice(data){
  const html = `
  <p><b>ID:</b> ${data.id}</p>
  <p><b>Khách hàng:</b> ${data.customer}</p>
  <p><b>Địa chỉ:</b> ${data.address}</p>
  <p><b>Sản phẩm:</b> ${data.product}</p>
  <p><b>IMEI:</b> ${data.imei}</p>
  <p><b>SL:</b> ${data.qty} | Giá: ${data.price.toLocaleString()} | Giảm: ${data.discount.toLocaleString()} | Tổng: ${data.total.toLocaleString()}</p>
  <p><b>Bằng chữ:</b> ${numberToWordsVN(data.total)}</p>
  <p><b>Bảo hành:</b> ${data.baohanh} tháng</p>
  <p><b>Ghi chú:</b> ${data.note}</p>
  `;
  document.getElementById('previewContent').innerHTML = html;
}

async function saveInvoice(){
  const invoiceData = {
    id: genInvoiceId(),
    date: new Date().toLocaleDateString('vi-VN'),
    customer: document.getElementById('tenkhach').value,
    sdt: document.getElementById('sdt').value,
    address: document.getElementById('diachi').value,
    product: document.getElementById('mathang').value,
    imei: document.getElementById('imei').value,
    qty: Number(document.getElementById('soluong').value),
    price: Number(document.getElementById('gia').value),
    discount: Number(document.getElementById('giam').value),
    total: Number(document.getElementById('soluong').value)*Number(document.getElementById('gia').value)-Number(document.getElementById('giam').value),
    baohanh: document.getElementById('baohanh').value,
    note: document.getElementById('ghichu').value,
    ownerName: "Ngô Minh Hoàng",
    ownerBank: "Techcombank: 9694999999",
    ownerContact: "0977.818.000"
  };

  previewInvoice(invoiceData);

  try{
    const res = await fetch(WEBAPP_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(invoiceData)
    });
    const result = await res.json();
    if(result.status==='ok') alert("Đã lưu vào Google Sheet!");
    else alert("Lỗi lưu: "+result.message);
  } catch(err){
    alert("Lỗi gửi dữ liệu: "+err.message);
  }
}

function resetForm(){
  document.getElementById('tenkhach').value='';
  document.getElementById('sdt').value='';
  document.getElementById('diachi').value='';
  document.getElementById('mathang').value='';
  document.getElementById('imei').value='';
  document.getElementById('soluong').value='1';
  document.getElementById('gia').value='0';
  document.getElementById('giam').value='0';
  document.getElementById('ghichu').value='';
  document.getElementById('baohanh').value='3';
  document.getElementById('previewContent').innerHTML='';
}
</script>
</body>
</html>
